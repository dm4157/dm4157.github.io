<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="项目中的一些用法

配置App路由中的#号Angular框架定义了自己的前端路由控制器，通过不同URL实现单面(ng-app)对视图(ng-view)的部署刷新，并支持HTML5的历史记录功能。默认情况下是不启动HTML5模式的，URL中会包括一个#号，用来区别是Angular管理的路径还是WebServer管理的路径。1234比如：http://watchdog.com/#/http://wa">
<meta property="og:type" content="article">
<meta property="og:title" content="angular手札:项目实践">
<meta property="og:url" content="http://dm4157.github.io/2016/04/19/angular2/index.html">
<meta property="og:site_name" content="蝉羽">
<meta property="og:description" content="项目中的一些用法

配置App路由中的#号Angular框架定义了自己的前端路由控制器，通过不同URL实现单面(ng-app)对视图(ng-view)的部署刷新，并支持HTML5的历史记录功能。默认情况下是不启动HTML5模式的，URL中会包括一个#号，用来区别是Angular管理的路径还是WebServer管理的路径。1234比如：http://watchdog.com/#/http://wa">
<meta property="og:image" content="http://7xrbi6.com1.z0.glb.clouddn.com/img-htppPOST%E8%AE%BE%E7%BD%AE%E4%B9%8B%E5%89%8D.png">
<meta property="og:image" content="http://7xrbi6.com1.z0.glb.clouddn.com/img-htppPOST%E8%AE%BE%E7%BD%AE%E4%B9%8B%E5%90%8E.png">
<meta property="og:updated_time" content="2017-07-25T07:06:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="angular手札:项目实践">
<meta name="twitter:description" content="项目中的一些用法

配置App路由中的#号Angular框架定义了自己的前端路由控制器，通过不同URL实现单面(ng-app)对视图(ng-view)的部署刷新，并支持HTML5的历史记录功能。默认情况下是不启动HTML5模式的，URL中会包括一个#号，用来区别是Angular管理的路径还是WebServer管理的路径。1234比如：http://watchdog.com/#/http://wa">
<meta name="twitter:image" content="http://7xrbi6.com1.z0.glb.clouddn.com/img-htppPOST%E8%AE%BE%E7%BD%AE%E4%B9%8B%E5%89%8D.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/my.jpg">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/my.jpg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/my.jpg">
          
        
    
    <!-- title -->
    <title>angular手札:项目实践</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2016/06/02/java3/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2016/04/10/angular1/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://dm4157.github.io/2016/04/19/angular2/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://dm4157.github.io/2016/04/19/angular2/&text=angular手札:项目实践"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li class="icon bdsharebuttonbox"><a href="javascript:void(0)" data-cmd="weixin" id="wexin" class="fa fa-comments bds_weixin" aria-hidden="true"></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://dm4157.github.io/2016/04/19/angular2/&title=angular手札:项目实践"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=angular手札:项目实践&body=Check out this article: http://dm4157.github.io/2016/04/19/angular2/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置App"><span class="toc-number">1.</span> <span class="toc-text">配置App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路由中的-号"><span class="toc-number">1.1.</span> <span class="toc-text">路由中的#号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">1.2.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http的参数们"><span class="toc-number">1.3.</span> <span class="toc-text">$http的参数们</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller的基本结构"><span class="toc-number">2.</span> <span class="toc-text">Controller的基本结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义基本变量"><span class="toc-number">2.1.</span> <span class="toc-text">定义基本变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化页面"><span class="toc-number">2.2.</span> <span class="toc-text">初始化页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面交互函数"><span class="toc-number">2.3.</span> <span class="toc-text">页面交互函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#记得“擦屁股“"><span class="toc-number">2.4.</span> <span class="toc-text">记得“擦屁股“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Angular中的增删改查"><span class="toc-number">3.</span> <span class="toc-text">Angular中的增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#增"><span class="toc-number">3.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删"><span class="toc-number">3.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#改"><span class="toc-number">3.3.</span> <span class="toc-text">改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查"><span class="toc-number">3.4.</span> <span class="toc-text">查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-number">4.</span> <span class="toc-text">附录</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        angular手札:项目实践
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">殇月陨</span>
      </span>
      
    <div class="postdate">
        <time datetime="2016-04-19T03:24:05.000Z" itemprop="datePublished">2016-04-19</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/angular/">angular</a>, <a class="tag-link" href="/tags/js/">js</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>项目中的一些用法</p>
</blockquote>
<h2 id="配置App"><a href="#配置App" class="headerlink" title="配置App"></a>配置App</h2><h3 id="路由中的-号"><a href="#路由中的-号" class="headerlink" title="路由中的#号"></a>路由中的#号</h3><p>Angular框架定义了自己的前端路由控制器，通过不同URL实现单面(ng-app)对视图(ng-view)的部署刷新，并支持HTML5的历史记录功能。<br>默认情况下是不启动<code>HTML5模式</code>的，URL中会包括一个#号，用来区别是Angular管理的路径还是WebServer管理的路径。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line">http://watchdog.com/#/</span><br><span class="line">http://watchdog.com/#/project</span><br><span class="line">http://watchdog.com/#/diagram</span><br></pre></td></tr></table></figure></p>
<p>这种体验其实不太友好，像锚点。不过Angular提供了一种HTML5模式的路由，可以直接去掉#号。<br>通过设置<code>$locationProvider</code>就行了。HTML5模式要求html页面中包含<code>&lt;base/&gt;</code>标签。不过在做微信开发时，发现微信浏览器似乎无法解析<code>&lt;base/&gt;</code>(也可能是打开方式不对)，只好关掉base；<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">watchdogApp.config(<span class="function"><span class="keyword">function</span>(<span class="params">$locationProvider</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 打开html5模式,否则路由跳转会加#; 去掉对&lt;base/&gt;的依赖</span></span><br><span class="line">    $locationProvider.html5Mode(&#123;</span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        requireBase: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>Angular提供了拦截器，概念与服务端的拦截器没什么区别， 我们可以在拦截器里做一些统一的处理，比如对错误信息的统一处理。<br>拦截器的定义如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$provide.factory(<span class="string">'myHttpInterceptor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$q, dependency1, dependency2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 请求成功</span></span><br><span class="line">    <span class="string">'request'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> config;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 请求失败</span></span><br><span class="line">   <span class="string">'requestError'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (canRecover(rejection)) &#123;</span><br><span class="line">        <span class="keyword">return</span> responseOrNewPromise</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 响应成功</span></span><br><span class="line">    <span class="string">'response'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 响应失败</span></span><br><span class="line">   <span class="string">'responseError'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (canRecover(rejection)) &#123;</span><br><span class="line">        <span class="keyword">return</span> responseOrNewPromise</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>在项目中目前使用了简单的异常拦截，对所有失败的请求统一处理，并弹出异常信息：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">feedbackApp.config(<span class="function"><span class="keyword">function</span>(<span class="params">$provide, $httpProvider</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 配置异常拦截器</span></span><br><span class="line">    $provide.factory(<span class="string">'ErrorInterceptor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$q</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"responseError"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (response.status == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// session过期是ajax请求会收到这个状态的回馈, 刷新页面以跳到登录页</span></span><br><span class="line">                    <span class="built_in">window</span>.location.reload();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response.data &amp;&amp; response.data.message) &#123;</span><br><span class="line">                    <span class="comment">// 弹出异常信息</span></span><br><span class="line">                    alert(response.data.message);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 这里可以讨论一下，如果不加这句，服务失败时页面无响应， 加了服务失败时会频繁跳出提示</span></span><br><span class="line">                    alert(<span class="string">"哎呀，服务器开小差了，再试一次！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> $q.reject(response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 注入异常拦截器</span></span><br><span class="line">    $httpProvider.interceptors.push(<span class="string">'ErrorInterceptor'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3 id="http的参数们"><a href="#http的参数们" class="headerlink" title="$http的参数们"></a>$http的参数们</h3><p>在使用Angular与后端（如Spring MVC）交互数据的时候，常遇见的问题是接收参数问题。事故常发生在<code>POST</code>请求上。<br>后端代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 新增项目</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Project <span class="title">newProject</span><span class="params">(Project project)</span> </span>&#123;</span><br><span class="line">    projectService.newProject(project);</span><br><span class="line">    <span class="keyword">return</span> project;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>前端请求：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求根路径</span></span><br><span class="line">$scope.baseUrl = <span class="string">"/project"</span>;</span><br><span class="line">...   </span><br><span class="line"><span class="comment">// 新增项目</span></span><br><span class="line">$http.post($scope.baseUrl, project)</span><br><span class="line">    .success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        $scope.projects.push(data);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>通常，这次请求会以服务端500收场。此时打开浏览器控制台，可查看到如下信息：<br><img src="http://7xrbi6.com1.z0.glb.clouddn.com/img-htppPOST%E8%AE%BE%E7%BD%AE%E4%B9%8B%E5%89%8D.png" alt="POST配置前"><br>Angular中<code>$http</code>服务的<strong>POST</strong>和<strong>PUT</strong>方法的传参方式默认是payload，即将对象解析为字符串整个传到后台，这种情况下应该如何接收参数呢？<br>你有两种方式：</p>
<p><strong>改变后端</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Project <span class="title">newProject</span><span class="params">(@RequestBody Project project)</span> </span>&#123;</span><br><span class="line">    projectService.newProject(project);</span><br><span class="line">    <span class="keyword">return</span> project;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关键在于<code>@RequestBody</code>，这个注解将请求体中所有的内容都作为<code>project</code>对象的内容，并通过spring将<code>JSON</code>字符串转换为<code>project</code>对象。</p>
<p><strong>改变前端</strong><br>改变Angular默认的提交方式，使用表单提交的模式，核心代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.config([<span class="string">'$httpProvider'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$httpProvider</span>)</span>&#123;</span><br><span class="line">    $httpProvider.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=utf-8'</span>;</span><br><span class="line">    $httpProvider.defaults.headers.put[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=utf-8'</span>;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure></p>
<p>变更之后请求的参数如下：<br><img src="http://7xrbi6.com1.z0.glb.clouddn.com/img-htppPOST%E8%AE%BE%E7%BD%AE%E4%B9%8B%E5%90%8E.png" alt="POST配置后"><br>在某些我也不知道的情况下（当时没有深究），会出现此种方式也不可以的情况，那么就要上杀手锏:将请求的对象转化成键值对的形式提交。结合上面的配置可解决绝大部分问题（目前没有遇到问题），而这个配置基本上是每个Angular应用的默认配置，所以将之抽象为一个模块，在需要的时候引用进来。完整代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    angular.module(<span class="string">'angular.config'</span>, []).config([<span class="string">'$httpProvider'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$httpProvider</span>)</span>&#123;</span><br><span class="line">        $httpProvider.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=utf-8'</span>;</span><br><span class="line">        $httpProvider.defaults.headers.put[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=utf-8'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> param = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> query = <span class="string">''</span>, name, value, fullSubName, subName, subValue, innerObj, i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">                value = obj[name];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;value.length; ++i) &#123;</span><br><span class="line">                        subValue = value[i];</span><br><span class="line">                        fullSubName = name + <span class="string">'['</span> + i + <span class="string">']'</span>;</span><br><span class="line">                        innerObj = &#123;&#125;;</span><br><span class="line">                        innerObj[fullSubName] = subValue;</span><br><span class="line">                        query += param(innerObj) + <span class="string">'&amp;'</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(subName <span class="keyword">in</span> value) &#123;</span><br><span class="line">                        subValue = value[subName];</span><br><span class="line">                        fullSubName = name + <span class="string">'.'</span> + subName;</span><br><span class="line">                        innerObj = &#123;&#125;;</span><br><span class="line">                        innerObj[fullSubName] = subValue;</span><br><span class="line">                        query += param(innerObj) + <span class="string">'&amp;'</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(value !== <span class="literal">undefined</span> &amp;&amp; value !== <span class="literal">null</span>)</span><br><span class="line">                    query += <span class="built_in">encodeURIComponent</span>(name) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(value) + <span class="string">'&amp;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> query.length ? query.substr(<span class="number">0</span>, query.length - <span class="number">1</span>) : query;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        $httpProvider.defaults.transformRequest = [<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> angular.isObject(data) &amp;&amp; <span class="built_in">String</span>(data) !== <span class="string">'[object File]'</span> ? param(data) : data;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;]);</span><br><span class="line">&#125;())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">var</span> watchdogApp = angular.module(<span class="string">'watchdogApp'</span>,[<span class="string">'angular.config'</span>, ...]);</span><br></pre></td></tr></table></figure></p>
<h2 id="Controller的基本结构"><a href="#Controller的基本结构" class="headerlink" title="Controller的基本结构"></a>Controller的基本结构</h2><h3 id="定义基本变量"><a href="#定义基本变量" class="headerlink" title="定义基本变量"></a>定义基本变量</h3><p>用Angular开发最大的特点就是对象化，通过改变对象的属性来控制前端的展示。</p>
<blockquote>
<p>栗子：在做列表查询时，通常把所有查询条件归纳为<code>query</code>对象，每次分页查询都将对象传给后端。同时根据对象的属性来显示筛选项</p>
</blockquote>
<p>此处不便多言，直接上代码。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tab页切换</span></span><br><span class="line">$rootScope.curTab = <span class="string">'project'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基本url</span></span><br><span class="line">$scope.projectUrl = <span class="string">"/project/"</span>;</span><br><span class="line">$scope.statisticUrl = <span class="string">"/statistic/"</span>;</span><br><span class="line">$scope.notificationUrl = <span class="string">"/notification/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前页的项目id</span></span><br><span class="line">$scope.pid = $routeParams.pid;</span><br></pre></td></tr></table></figure></p>
<h3 id="初始化页面"><a href="#初始化页面" class="headerlink" title="初始化页面"></a>初始化页面</h3><p>在进入页面时一般只会获得最基本的信息，比如列表页的页码、详情页的实体id，那么在<code>controller</code>中就要对页面进行初始化。</p>
<blockquote>
<p>非Angular中，列表页数据或实体信息一般是在后台控制器中查询好，放到<code>model</code>里然后跳转页面。而在Angular中往往是先跳转到单页，再请求数据。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**初始化*/</span></span><br><span class="line">$scope.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $scope.initProject();</span><br><span class="line">    $scope.initStatistic();</span><br><span class="line">    $scope.initNotification();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义好初始化方法，一定要记得调用，并且顺序不能错</span></span><br><span class="line">$scope.init();</span><br></pre></td></tr></table></figure>
<h3 id="页面交互函数"><a href="#页面交互函数" class="headerlink" title="页面交互函数"></a>页面交互函数</h3><p>页面上的增删改查都在此声明，比如<code>ng-click</code>。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除通知项</span></span><br><span class="line">$scope.deleteNotification = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 显示全部内容</span></span><br><span class="line">$scope.showAllContent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="记得“擦屁股“"><a href="#记得“擦屁股“" class="headerlink" title="记得“擦屁股“"></a>记得“擦屁股“</h3><p>如果页面中存在周期型任务，记得在销毁<code>controller</code>时处理掉，比如<code>$interval</code>、JS的各种监听。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$scope.$on(<span class="string">'$destroy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       $interval.cancel($scope.freshDiagram);</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">"停止刷新前任"</span>);</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="Angular中的增删改查"><a href="#Angular中的增删改查" class="headerlink" title="Angular中的增删改查"></a>Angular中的增删改查</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><ul>
<li>在弹层中使用双向绑定，将输入的信息绑定到<code>$scope</code>的属性中</li>
<li>使用<code>$http</code>将数据提交给服务端，一般使用<strong>POST</strong></li>
<li>接收后端返回的对象（或对象id），并将之添加到<code>$scope</code>的实体列表里（如果有的话）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"modal-title"</span>&gt;</span>关注一个项目<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"project.projectName"</span> <span class="attr">placeholder</span>=<span class="string">"项目名称写上来"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">rows</span>=<span class="string">"3"</span> <span class="attr">ng-model</span>=<span class="string">"project.description"</span> <span class="attr">placeholder</span>=<span class="string">"简单介绍下吧"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-footer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"ok()"</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$scope.ok = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $http.post($scope.baseUrl, project)</span><br><span class="line">      .success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">          $scope.projects.push(data);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><p>使用<code>delete</code>方法，删除成功后，从数据列表中删除这个对象<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"project in projects"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"deleteProject($index)"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除项目</span></span><br><span class="line">$scope.deleteProject = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(!confirm(<span class="string">"确实要删除该项目么?相关统计阈和通知项都会被删除."</span>)) &#123;</span><br><span class="line">       <span class="keyword">return</span> ;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $http.delete($scope.projectUrl + $scope.projects[index].id + <span class="string">"/info"</span>)</span><br><span class="line">       .success(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           $scope.projects.splice(index, <span class="number">1</span>);</span><br><span class="line">       &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><p>修改数据时，记得复制一份更改，更改完毕后再更新回去<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复制要修改的对象， 否则在弹层中改动，列表中实际数据也会跟着变动</span></span><br><span class="line"><span class="keyword">var</span> editModel = angular.extend(&#123;&#125;, $scope.project);</span><br><span class="line"><span class="comment">// 修改完毕后记得更新回去</span></span><br><span class="line">$http.put($scope.projectUrl, project)</span><br><span class="line">    .success(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $scope.project = project;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><ul>
<li>将页面查询用到的字段归纳到一个对象<code>query</code>中，包括筛选条件、当前页码（用于翻页）等</li>
<li>监听<code>query</code>的变化，根据需求调用查询方法</li>
<li>查询成功后，更新<code>$scope</code>里的列表数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"boxWrapBlue pd_10 mt_15"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix searchFilter pd_6"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span>关键字：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txtNew tt280"</span> <span class="attr">ng-model</span>=<span class="string">"query.keyword"</span> <span class="attr">placeholder</span>=<span class="string">"请输入SIM卡号、设备号、手机号等"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ml_15 pl_20"</span>&gt;</span>入库时间：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dui-date-picker</span> <span class="attr">date</span>=<span class="string">"query.dateFrom"</span>&gt;</span><span class="tag">&lt;/<span class="name">dui-date-picker</span>&gt;</span> -</span><br><span class="line">                <span class="tag">&lt;<span class="name">dui-date-picker</span> <span class="attr">date</span>=<span class="string">"query.dateTo"</span>&gt;</span><span class="tag">&lt;/<span class="name">dui-date-picker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right center bdL_ccc"</span> <span class="attr">style</span>=<span class="string">"width:120px;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"btn-small btn-blue in_block"</span> <span class="attr">ng-click</span>=<span class="string">"queryData()"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"boxWrapFilter2"</span> <span class="attr">style</span>=<span class="string">"border-top:none;padding:10px 6px;"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pr_10"</span>&gt;</span>部门：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">duitree</span> <span class="attr">tree-type</span>=<span class="string">"popup"</span>  <span class="attr">datasource-type</span>=<span class="string">"all"</span> <span class="attr">selected-data</span>=<span class="string">"query.org"</span> <span class="attr">contain-employee</span>=<span class="string">"true"</span> <span class="attr">org-status</span>=<span class="string">"1"</span> <span class="attr">can-reset</span>=<span class="string">"true"</span> <span class="attr">searchable</span>=<span class="string">"true"</span> <span class="attr">reject-public</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">duitree</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ml_20 pl_20"</span>&gt;</span>在职状态：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">search-filter</span> <span class="attr">class</span>=<span class="string">"searchFilter"</span> <span class="attr">datasource</span>=<span class="string">"dictionary.empStatus"</span> <span class="attr">selected</span>=<span class="string">"query.empStatus"</span> <span class="attr">allvalue</span>=<span class="string">""</span> <span class="attr">alltext</span>=<span class="string">"不限"</span> <span class="attr">valuealias</span>=<span class="string">"value"</span> <span class="attr">textalias</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">search-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ml_20 pl_20"</span>&gt;</span>手机类型：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">search-filter</span> <span class="attr">class</span>=<span class="string">"searchFilter"</span> <span class="attr">datasource</span>=<span class="string">"dictionary.phoneType"</span> <span class="attr">selected</span>=<span class="string">"query.phoneType"</span> <span class="attr">allvalue</span>=<span class="string">""</span> <span class="attr">alltext</span>=<span class="string">"不限"</span> <span class="attr">valuealias</span>=<span class="string">"value"</span> <span class="attr">textalias</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">search-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bdT_ccc mt_10 pt_10"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"padding:10px 6px;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>状态：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">status-search-filter</span> <span class="attr">class</span>=<span class="string">"searchFilter"</span> <span class="attr">datasource</span>=<span class="string">"dictionary.statusDictionary"</span> <span class="attr">count-map</span>=<span class="string">"subTotal"</span> <span class="attr">selected</span>=<span class="string">"query.curStatus"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 归纳</span></span><br><span class="line"><span class="comment">//查询条件</span></span><br><span class="line">$scope.query = &#123;</span><br><span class="line">    keyword: <span class="string">''</span>,</span><br><span class="line">    empStatus: <span class="string">''</span>,</span><br><span class="line">    phoneType: <span class="string">''</span>,</span><br><span class="line">    dateFrom:<span class="literal">null</span>,</span><br><span class="line">    dateTo:<span class="literal">null</span>,</span><br><span class="line">    org:</span><br><span class="line">    &#123;</span><br><span class="line">        type:<span class="string">''</span>,</span><br><span class="line">        id:<span class="number">0</span></span><br><span class="line">    &#125;, <span class="comment">//部门对象</span></span><br><span class="line">    currentPage:<span class="number">1</span>, <span class="comment">//当前页号</span></span><br><span class="line">    curStatus:<span class="number">0</span> <span class="comment">// 当前选中的手机状态，0是全部</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监控查询参数变化</span></span><br><span class="line">$scope.$watch(<span class="string">'query'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">oldValue, newValue</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 根据组织架构选择器的选项，判断是员工还是组织，并向后台发送相应的请求参数</span></span><br><span class="line">    <span class="keyword">if</span> ($scope.query.org) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($scope.query.org.type == <span class="string">'员工'</span>) &#123;</span><br><span class="line">            $scope.query.empNo = $scope.query.org.id;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $scope.query.orgNo = $scope.query.org.id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (oldValue.keyword != newValue.keyword</span><br><span class="line">        || oldValue.dateFrom != newValue.dateFrom</span><br><span class="line">        || oldValue.dateTo != newValue.dateTo) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果变化的不是页码，将页码初始化</span></span><br><span class="line">    <span class="keyword">if</span> (oldValue.currentPage == newValue.currentPage) &#123;</span><br><span class="line">        $scope.query.currentPage = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 一旦改变就重新查询</span></span><br><span class="line">    $scope.queryData();</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用查询方法</span></span><br><span class="line">$scope.queryData = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 根据组织架构选择器的选项，判断是员工还是组织，并向后台发送相应的请求参数</span></span><br><span class="line">   <span class="keyword">if</span> ($scope.query.org) &#123;</span><br><span class="line">       <span class="keyword">if</span> ($scope.query.org.type == <span class="string">'员工'</span>) &#123;</span><br><span class="line">           $scope.query.empNo = $scope.query.org.id;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           $scope.query.orgNo = $scope.query.org.id;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   $http.get($scope.baseUrl + <span class="string">"/list/"</span> + $scope.query.currentPage, &#123;params:$scope.query&#125;)</span><br><span class="line">       .success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">           $scope.paginate = data.paginate;</span><br><span class="line">           $scope.subTotal = data.subTotal;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求完要把临时加上的参数删掉</span></span><br><span class="line">   <span class="keyword">if</span>($scope.query.empNo) &#123;</span><br><span class="line">       <span class="keyword">delete</span> $scope.query.empNo;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>($scope.query.orgNo) &#123;</span><br><span class="line">       <span class="keyword">delete</span> $scope.query.orgNo;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>###简单Controller的完整代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">feedbackApp.controller(<span class="string">'FeedbackListController'</span>, [<span class="string">'$scope'</span>, <span class="string">'$http'</span>, <span class="string">'$location'</span>, <span class="string">'anchorScroll'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $http, $location, anchorScroll</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 是否到了最后</span></span><br><span class="line">    $scope.endLoad = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 加载中</span></span><br><span class="line">    $scope.loading = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 反馈的根路径</span></span><br><span class="line">    $scope.feedbackUrl = <span class="string">"/feedback/"</span>;</span><br><span class="line">    <span class="comment">// 当前页码</span></span><br><span class="line">    $scope.curPage = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 初始化反馈列表</span></span><br><span class="line">    $scope.feedbacks = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载中toast</span></span><br><span class="line">    $scope.loadingToast = &#123;</span><br><span class="line">        <span class="string">"isLoading"</span> : <span class="string">""</span>,</span><br><span class="line">        <span class="string">"loadingMsg"</span> : <span class="string">"加载中"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询反馈分页数据</span></span><br><span class="line">    $scope.queryFeedback = <span class="function"><span class="keyword">function</span>(<span class="params">pageNo</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 打开加载状态</span></span><br><span class="line">        $scope.loading = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 个人反馈总数</span></span><br><span class="line">        $http.get($scope.feedbackUrl + <span class="string">"count"</span>)</span><br><span class="line">            .success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                $scope.count = data;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分页数据</span></span><br><span class="line">        $http.get($scope.feedbackUrl + <span class="string">"page/"</span> + pageNo)</span><br><span class="line">            .success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!data || data.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    $scope.endLoad = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                $scope.feedbacks = $scope.feedbacks.concat(data);</span><br><span class="line">                $scope.pageNo = pageNo;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 关闭加载</span></span><br><span class="line">                $scope.loading = <span class="literal">false</span>;</span><br><span class="line">                $scope.loadingToast = &#123;</span><br><span class="line">                    <span class="string">"isLoading"</span> : <span class="string">"ng-hide"</span>,</span><br><span class="line">                    <span class="string">"loadingMsg"</span> : <span class="string">""</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;)</span><br><span class="line">            .error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                $scope.loading = <span class="literal">false</span>;</span><br><span class="line">                $scope.loadingToast = &#123;</span><br><span class="line">                    <span class="string">"isLoading"</span> : <span class="string">"ng-hide"</span>,</span><br><span class="line">                    <span class="string">"loadingMsg"</span> : <span class="string">""</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化第一页数据</span></span><br><span class="line">    $scope.queryFeedback(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回到顶部</span></span><br><span class="line">    $scope.turnTop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        anchorScroll.toView(<span class="string">'#top'</span>, <span class="literal">true</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 滚动到底部加载</span></span><br><span class="line">    $(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获得滚动高度</span></span><br><span class="line">        $scope.height = <span class="built_in">document</span>.body.scrollTop;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 滚动到底部加载</span></span><br><span class="line">        <span class="keyword">if</span> (!$scope.endLoad &amp;&amp; !$scope.loading &amp;&amp; ($(<span class="built_in">document</span>).scrollTop() + $(<span class="built_in">window</span>).height() &gt;= $(<span class="built_in">document</span>).height())) &#123;</span><br><span class="line">            $scope.queryFeedback($scope.pageNo + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $scope.$apply();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $scope.$on(<span class="string">'$destroy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="built_in">window</span>).unbind(<span class="string">'scroll'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入详情页</span></span><br><span class="line">    $scope.detail = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        $location.path($scope.feedbackUrl + <span class="string">"detail/"</span> + $scope.feedbacks[index].id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure></p>

  </div>
</article>

<section class="reward">
	<a class="btn-reward dashang" href="#">打赏</a>
	<div class="reward-wrapper clearfix">
		<img src="/images/dashang.png" title="微信">
	</div>
</section>


	<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTczMS82Mjk3"></div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置App"><span class="toc-number">1.</span> <span class="toc-text">配置App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路由中的-号"><span class="toc-number">1.1.</span> <span class="toc-text">路由中的#号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拦截器"><span class="toc-number">1.2.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http的参数们"><span class="toc-number">1.3.</span> <span class="toc-text">$http的参数们</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller的基本结构"><span class="toc-number">2.</span> <span class="toc-text">Controller的基本结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义基本变量"><span class="toc-number">2.1.</span> <span class="toc-text">定义基本变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化页面"><span class="toc-number">2.2.</span> <span class="toc-text">初始化页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面交互函数"><span class="toc-number">2.3.</span> <span class="toc-text">页面交互函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#记得“擦屁股“"><span class="toc-number">2.4.</span> <span class="toc-text">记得“擦屁股“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Angular中的增删改查"><span class="toc-number">3.</span> <span class="toc-text">Angular中的增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#增"><span class="toc-number">3.1.</span> <span class="toc-text">增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删"><span class="toc-number">3.2.</span> <span class="toc-text">删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#改"><span class="toc-number">3.3.</span> <span class="toc-text">改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查"><span class="toc-number">3.4.</span> <span class="toc-text">查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-number">4.</span> <span class="toc-text">附录</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://dm4157.github.io/2016/04/19/angular2/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://dm4157.github.io/2016/04/19/angular2/&text=angular手札:项目实践"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li class="icon bdsharebuttonbox"><a href="javascript:void(0)" data-cmd="weixin" id="wexin" class="fa fa-comments bds_weixin" aria-hidden="true"></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://dm4157.github.io/2016/04/19/angular2/&title=angular手札:项目实践"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=angular手札:项目实践&body=Check out this article: http://dm4157.github.io/2016/04/19/angular2/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 殇月陨
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

<!-- 来比力评论 -->
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<!-- 百度分享 -->
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-103162179-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


